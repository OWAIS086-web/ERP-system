{% extends "layout.html" %}

{% block page_title %}Activities{% endblock %}
{% block page_subtitle %}System activities and audit trail{% endblock %}

{% block page_icon %}
<i class="fas fa-history text-primary"></i>
{% endblock %}

{% block page_actions %}
<div class="d-flex gap-2">
    <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#filterModal">
        <i class="fas fa-filter"></i> Filter
    </button>
    <button class="btn btn-outline-secondary" onclick="exportActivities()">
        <i class="fas fa-download"></i> Export
    </button>
    <button class="btn btn-primary" onclick="refreshActivities()">
        <i class="fas fa-sync-alt"></i> Refresh
    </button>
</div>
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item active">Activities</li>
{% endblock %}

{% block page_content %}
<div class="row">
    <div class="col-12">
        <div class="glass-card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-history me-2"></i>Recent Activities
                    </h5>
                    <div class="activity-filters">
                        <button class="btn btn-sm btn-outline-primary active" data-filter="all">All</button>
                        <button class="btn btn-sm btn-outline-primary" data-filter="user">Users</button>
                        <button class="btn btn-sm btn-outline-primary" data-filter="order">Orders</button>
                        <button class="btn btn-sm btn-outline-primary" data-filter="system">System</button>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="activities-timeline">
                    <!-- Today -->
                    <div class="timeline-section">
                        <div class="timeline-header">
                            <h6 class="timeline-date">Today</h6>
                        </div>
                        
                        <div class="timeline-item user-activity">
                            <div class="timeline-marker bg-primary">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">New User Registration</div>
                                    <div class="timeline-time">2 minutes ago</div>
                                </div>
                                <div class="timeline-description">
                                    <strong>John Smith</strong> registered as a new user and is pending approval.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-info">User Management</span>
                                    <span class="text-muted">IP: 192.168.1.100</span>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item order-activity">
                            <div class="timeline-marker bg-success">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">Order Completed</div>
                                    <div class="timeline-time">15 minutes ago</div>
                                </div>
                                <div class="timeline-description">
                                    Order <strong>#ORD-123</strong> has been completed and shipped to customer ABC Corp.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-success">Sales</span>
                                    <span class="text-muted">Amount: $2,500.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item system-activity critical">
                            <div class="timeline-marker bg-danger">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">System Alert</div>
                                    <div class="timeline-time">1 hour ago</div>
                                </div>
                                <div class="timeline-description">
                                    Database backup failed - immediate attention required.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-danger">Critical</span>
                                    <span class="text-muted">System</span>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item order-activity">
                            <div class="timeline-marker bg-warning">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">Payment Overdue</div>
                                    <div class="timeline-time">2 hours ago</div>
                                </div>
                                <div class="timeline-description">
                                    Invoice <strong>#INV-001</strong> from ABC Corp is now 5 days overdue.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-warning">Finance</span>
                                    <span class="text-muted">Amount: $1,250.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Yesterday -->
                    <div class="timeline-section">
                        <div class="timeline-header">
                            <h6 class="timeline-date">Yesterday</h6>
                        </div>
                        
                        <div class="timeline-item user-activity">
                            <div class="timeline-marker bg-info">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">Inventory Update</div>
                                    <div class="timeline-time">Yesterday at 4:30 PM</div>
                                </div>
                                <div class="timeline-description">
                                    Stock levels updated for 15 products. Low stock alerts generated.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-info">Inventory</span>
                                    <span class="text-muted">Automated</span>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item user-activity">
                            <div class="timeline-marker bg-primary">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">Invoice Generated</div>
                                    <div class="timeline-time">Yesterday at 2:15 PM</div>
                                </div>
                                <div class="timeline-description">
                                    Invoice <strong>#INV-002</strong> generated for customer XYZ Ltd.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-primary">Finance</span>
                                    <span class="text-muted">Amount: $3,750.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="timeline-item system-activity">
                            <div class="timeline-marker bg-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="timeline-content">
                                <div class="timeline-header-content">
                                    <div class="timeline-title">Backup Completed</div>
                                    <div class="timeline-time">Yesterday at 12:00 AM</div>
                                </div>
                                <div class="timeline-description">
                                    Daily database backup completed successfully.
                                </div>
                                <div class="timeline-meta">
                                    <span class="badge bg-success">System</span>
                                    <span class="text-muted">Automated</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Load More -->
                    <div class="timeline-load-more">
                        <button class="btn btn-outline-primary" onclick="loadMoreActivities()">
                            <i class="fas fa-chevron-down"></i> Load More Activities
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">
                    <i class="fas fa-filter me-2"></i>Filter Activities
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="dateRange" class="form-label">Date Range</label>
                    <select class="form-select" id="dateRange">
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="week" selected>Last 7 days</option>
                        <option value="month">Last 30 days</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="activityType" class="form-label">Activity Type</label>
                    <select class="form-select" id="activityType">
                        <option value="all">All Types</option>
                        <option value="user">User Activities</option>
                        <option value="order">Order Activities</option>
                        <option value="system">System Activities</option>
                        <option value="finance">Finance Activities</option>
                        <option value="inventory">Inventory Activities</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="severity" class="form-label">Severity</label>
                    <select class="form-select" id="severity">
                        <option value="all">All Levels</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="searchText" class="form-label">Search Text</label>
                    <input type="text" class="form-control" id="searchText" placeholder="Search in activities...">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyFilters()">
                    <i class="fas fa-search"></i> Apply Filters
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.activities-timeline {
    padding: 0;
}

.timeline-section {
    margin-bottom: 32px;
}

.timeline-header {
    padding: 16px 24px;
    background: rgba(255, 255, 255, 0.05);
    border-bottom: 1px solid var(--glass-border);
}

.timeline-date {
    color: var(--text-primary);
    font-weight: 600;
    margin: 0;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.timeline-item {
    display: flex;
    padding: 20px 24px;
    border-bottom: 1px solid var(--glass-border);
    transition: all 0.3s ease;
    position: relative;
}

.timeline-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.timeline-item.critical {
    border-left: 4px solid var(--danger-color);
    background: rgba(239, 68, 68, 0.05);
}

.timeline-marker {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    flex-shrink: 0;
    margin-right: 16px;
    position: relative;
}

.timeline-marker::after {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 50%;
    background: inherit;
    opacity: 0.2;
    z-index: -1;
}

.timeline-content {
    flex: 1;
    min-width: 0;
}

.timeline-header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.timeline-title {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
}

.timeline-time {
    font-size: 12px;
    color: var(--text-muted);
    white-space: nowrap;
}

.timeline-description {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 12px;
}

.timeline-meta {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.timeline-meta .badge {
    font-size: 11px;
    padding: 4px 8px;
}

.timeline-load-more {
    text-align: center;
    padding: 24px;
    border-top: 1px solid var(--glass-border);
}

.activity-filters {
    display: flex;
    gap: 8px;
}

.activity-filters .btn.active {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

/* Activity type specific styles */
.user-activity .timeline-marker {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

.order-activity .timeline-marker {
    background: linear-gradient(135deg, var(--success-color), #38ef7d);
}

.system-activity .timeline-marker {
    background: linear-gradient(135deg, var(--info-color), #06b6d4);
}

.system-activity.critical .timeline-marker {
    background: linear-gradient(135deg, var(--danger-color), #fe6b8b);
}

/* Responsive design */
@media (max-width: 768px) {
    .timeline-item {
        padding: 16px;
    }
    
    .timeline-marker {
        width: 40px;
        height: 40px;
        font-size: 16px;
        margin-right: 12px;
    }
    
    .timeline-header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    
    .activity-filters {
        flex-wrap: wrap;
        gap: 4px;
    }
    
    .activity-filters .btn {
        font-size: 12px;
        padding: 4px 8px;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Filter activities
    $('.activity-filters .btn').click(function() {
        $('.activity-filters .btn').removeClass('active');
        $(this).addClass('active');
        
        const filter = $(this).data('filter');
        const items = $('.timeline-item');
        
        items.show();
        
        if (filter !== 'all') {
            items.not('.' + filter + '-activity').hide();
        }
    });
});

function refreshActivities() {
    // Show loading state
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
    btn.disabled = true;
    
    // Simulate refresh
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        window.notificationManager?.showToast('Activities refreshed', 'success');
    }, 1500);
}

function loadMoreActivities() {
    const btn = event.target.closest('button');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    btn.disabled = true;
    
    // Simulate loading more activities
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        window.notificationManager?.showToast('No more activities to load', 'info');
    }, 1000);
}

function exportActivities() {
    window.notificationManager?.showToast('Export feature coming soon', 'info');
}

function applyFilters() {
    const dateRange = document.getElementById('dateRange').value;
    const activityType = document.getElementById('activityType').value;
    const severity = document.getElementById('severity').value;
    const searchText = document.getElementById('searchText').value;
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('filterModal'));
    modal.hide();
    
    // Apply filters (in a real app, this would make an API call)
    window.notificationManager?.showToast('Filters applied successfully', 'success');
}
</script>
{% endblock %}